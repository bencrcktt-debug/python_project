<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0d1625;
      --panel: #111c2f;
      --panel2: #0b1422;
      --text: #e8eef7;
      --muted: #aab7c9;
      --accent: #1e90ff;
      --accent2: #00e0b8;
      --border: #1f2c42;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 32px;
      font-family: "IBM Plex Sans", "Segoe UI", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    h1, h2, h3 { margin: 0 0 8px 0; }
    h1 { font-size: 28px; }
    h2 { font-size: 20px; margin-top: 18px; }
    h3 { font-size: 16px; margin-top: 12px; }
    p { margin: 0 0 10px 0; }
    .hero {
      background: linear-gradient(135deg, rgba(30,144,255,0.24), rgba(0,224,184,0.16), rgba(11,20,34,0.85));
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px 18px 14px 18px;
      margin-bottom: 18px;
    }
    .meta { color: var(--muted); font-size: 12px; margin-top: 6px; }
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin: 12px 0 4px 0;
    }
    .kpi {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
    }
    .kpi .label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; }
    .kpi .value { font-size: 18px; font-weight: 700; margin-top: 4px; }
    .section {
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 14px 10px 14px;
      margin-top: 12px;
    }
    .pill {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border);
      font-size: 12px;
      color: var(--muted);
      margin-right: 6px;
      margin-bottom: 6px;
    }
    .list-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 13px;
    }
    th, td {
      text-align: left;
      padding: 8px 6px;
      border: 1px solid var(--border);
    }
    th { background: rgba(255,255,255,0.06); color: var(--text); }
    td { color: var(--text); }
    .muted { color: var(--muted); }
    .bullets { padding-left: 16px; margin: 8px 0; }
    .bullets li { margin: 4px 0; }
    .footer { margin-top: 20px; font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="hero">
    <h1>{{ payload.get("report_title") or "Taxpayer-Funded Lobbying Report" }}</h1>
    <div class="meta">
      Session: {{ payload.get("session_label","") }} |
      Scope: {{ payload.get("scope_session_label") or payload.get("scope_label","") }} |
      Focus: {{ payload.get("focus_label","") }}
    </div>
    <div class="meta">
      Generated: {{ payload.get("generated_ts") or payload.get("generated_date","") }} |
      Report ID: {{ payload.get("report_id","") }}
    </div>
    {% if payload.get("filter_summary") %}
      <div class="meta">Filters: {{ payload.get("filter_summary") }}</div>
    {% endif %}
  </div>

  <div class="section">
    <h2>Key Metrics</h2>
    <div class="kpi-grid">
      <div class="kpi">
        <div class="label">Total range</div>
        <div class="value">{{ payload.get("total_low","") }} – {{ payload.get("total_high","") }}</div>
      </div>
      <div class="kpi">
        <div class="label">Taxpayer-funded range</div>
        <div class="value">{{ payload.get("tfl_low","") }} – {{ payload.get("tfl_high","") }}</div>
      </div>
      <div class="kpi">
        <div class="label">Private range</div>
        <div class="value">{{ payload.get("private_low","") }} – {{ payload.get("private_high","") }}</div>
      </div>
      <div class="kpi">
        <div class="label">Taxpayer share</div>
        <div class="value">{{ payload.get("tfl_share_low_pct","0") }}% – {{ payload.get("tfl_share_high_pct","0") }}%</div>
      </div>
      <div class="kpi">
        <div class="label">Unique lobbyists</div>
        <div class="value">{{ payload.get("unique_lobbyists_total","0") }}</div>
      </div>
      <div class="kpi">
        <div class="label">Unique clients</div>
        <div class="value">{{ payload.get("unique_clients_total","0") }}</div>
      </div>
    </div>
    {% if payload.get("scope_note") %}
      <p class="muted">{{ payload.get("scope_note") }}</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>Funding Mix</h2>
    <p class="muted">Midpoint of reported compensation ranges by funding source.</p>
    <div class="list-grid">
      <div>
        <h3>Taxpayer-funded</h3>
        <p>{{ payload.get("tfl_low","") }} – {{ payload.get("tfl_high","") }}</p>
      </div>
      <div>
        <h3>Private</h3>
        <p>{{ payload.get("private_low","") }} – {{ payload.get("private_high","") }}</p>
      </div>
    </div>
  </div>

  {% set top_tfl = payload.get("top_clients_tfl") or [] %}
  {% set top_priv = payload.get("top_clients_private") or [] %}
  {% if top_tfl or top_priv %}
    <div class="section">
      <h2>Top Clients</h2>
      {% if top_tfl %}
        <h3>Taxpayer-funded</h3>
        <table>
          <tr><th>Client</th><th>Range</th></tr>
          {% for row in top_tfl %}
            <tr>
              <td>{{ row.get("Client","") }}</td>
              <td>
                {{ "{:,.0f}".format(row.get("Low", 0)) if row.get("Low") is not none else "-" }}
                {% if row.get("High") is not none %} – {{ "{:,.0f}".format(row.get("High", 0)) }}{% endif %}
              </td>
            </tr>
          {% endfor %}
        </table>
      {% endif %}
      {% if top_priv %}
        <h3>Private</h3>
        <table>
          <tr><th>Client</th><th>Range</th></tr>
          {% for row in top_priv %}
            <tr>
              <td>{{ row.get("Client","") }}</td>
              <td>
                {{ "{:,.0f}".format(row.get("Low", 0)) if row.get("Low") is not none else "-" }}
                {% if row.get("High") is not none %} – {{ "{:,.0f}".format(row.get("High", 0)) }}{% endif %}
              </td>
            </tr>
          {% endfor %}
        </table>
      {% endif %}
    </div>
  {% endif %}

  {% set focus = payload.get("focus_section") %}
  {% if focus %}
    <div class="section">
      <h2>Focus: {{ focus.get("title","") }}</h2>
      {% if focus.get("summary") %}<p>{{ focus.get("summary") }}</p>{% endif %}
      {% if focus.get("metrics") %}
        <div class="kpi-grid">
          {% for label, value in focus.get("metrics") %}
            <div class="kpi">
              <div class="label">{{ label }}</div>
              <div class="value">{{ value }}</div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      {% if focus.get("bullets") %}
        <ul class="bullets">
          {% for bullet in focus.get("bullets") %}
            <li>{{ bullet }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  {% endif %}

  {% set top_bills = payload.get("top_bills") or [] %}
  {% if top_bills %}
    <div class="section">
      <h2>Top Bills Opposed by Taxpayer-Funded Lobbyists</h2>
      <table>
        <tr><th>Bill</th><th>Oppositions</th><th>Summary</th></tr>
        {% for row in top_bills[:5] %}
          <tr>
            <td>{{ row.get("id","") }}</td>
            <td>{{ row.get("tfl","") }}</td>
            <td>{{ row.get("summary","") }}</td>
          </tr>
        {% endfor %}
      </table>
    </div>
  {% endif %}

  {% set top_subjects = payload.get("top_subjects") or [] %}
  {% if top_subjects %}
    <div class="section">
      <h2>Top Policy Areas</h2>
      <table>
        <tr><th>Policy Area</th><th>Oppositions</th></tr>
        {% for row in top_subjects[:5] %}
          <tr>
            <td>{{ row.get("Subject","") }}</td>
            <td>{{ row.get("Oppositions","") }}</td>
          </tr>
        {% endfor %}
      </table>
    </div>
  {% endif %}

  <div class="section">
    <h2>Data Sources & Methodology</h2>
    <ul class="bullets">
      {% for line in (payload.get("data_sources_bullets","").splitlines()) if line.strip() %}
        <li>{{ line.lstrip("- ") }}</li>
      {% endfor %}
    </ul>
    <p class="muted">Disclaimer: {{ payload.get("disclaimer_note","Figures are based on reported ranges and should be read as conservative estimates.") }}</p>
  </div>

  <div class="footer">
    Prepared by Texas Lobby Data Center · {{ payload.get("generated_date") or payload.get("generated_ts","") }} · Report ID {{ payload.get("report_id","") }}
  </div>
</body>
</html>
